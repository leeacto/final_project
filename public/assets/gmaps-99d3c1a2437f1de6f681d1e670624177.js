function codeAddress(a){var e=new google.maps.Geocoder;e.geocode({address:a.address},function(e,o){if(o===google.maps.GeocoderStatus.OK){var t=e[0].geometry.location.lat(),s=e[0].geometry.location.lng();pkg={lat:t,lon:s,id:a.id},$.ajax({url:"/restaurants/setcoords",method:"POST",data:pkg})}})}function cardSetup(){var a=new restTable(".restaurant_list");a.initialize()}var restTable=function(a){this.el=$(a),this.cards=[]};restTable.prototype.initialize=function(){var a=this;$(".card").each(function(){var e=$(this).find(".card_url")[0].innerHTML.replace("<a href","");this.url=e.substring(3,e.indexOf("/dishes"));var o=new Card(this.id,this.url);a.cards.push(o)})};var Card=function(a,e){this.el=$("#"+a),this.url=e;var o=this;this.geocoder=new google.maps.Geocoder,$("body").on("click","#"+a+" .front",function(a){a.stopPropagation(),$(a.target).closest(".card").addClass("active"),o.el.find(".gmap").removeClass("hidden"),o.el.find(".favrest").addClass("hidden"),o.el.find(".favdish").addClass("hidden"),0===o.el.find(".gmap img").length&&o.el.find(".gmap").length>0&&o.addMap()}),$("body").on("click","#"+a+" .back",function(a){a.stopPropagation(),$(a.target).closest(".card").removeClass("active"),o.el.find(".favrest").removeClass("hidden"),o.el.find(".favdish").removeClass("hidden"),o.el.find(".gmap").addClass("hidden")}),this.el.find("a").on("click",function(a){a.stopPropagation()})};Card.prototype.addMap=function(){var a,e,o=this.el;this.url;var t=this,s=o.selector.replace("#card-","");$.ajax({url:"/"+this.url+"/coords",method:"get",data:this.url,dataType:"json"}).done(function(o){if(null!=o.latitude){a=o.latitude,e=o.longitude;var r=new google.maps.LatLng(a,e);({zoom:11,center:r,disableDefaultUI:!0,zoomControl:!0,scaleControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP});var n="http://maps.googleapis.com/maps/api/staticmap?center="+a+","+e+"&zoom=13&size=129x158&maptype=roadmap&markers=color:red%7C"+a+","+e+"&sensor=false",d="<a href='http://maps.google.com/?q="+o.gsearch+"' target='_blank'><img src='"+n+"'></a>";$("#map-canvas-"+s).html(""),$("#map-canvas-"+s).append(d),$("#map-canvas-"+s).on("click",function(a){a.stopPropagation()})}else t.geocoder.geocode({address:o.address},function(r,n){if(n===google.maps.GeocoderStatus.OK){a=r[0].geometry.location.lat(),e=r[0].geometry.location.lng(),pkg={lat:a,lon:e,url:t.url},$.ajax({url:"/restaurants/setcoords",method:"POST",data:pkg});var d=new google.maps.LatLng(a,e);({zoom:11,center:d,disableDefaultUI:!0,zoomControl:!0,scaleControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP});var i="http://maps.googleapis.com/maps/api/staticmap?center="+a+","+e+"&zoom=13&size=129x158&maptype=roadmap&markers=color:red%7C"+a+","+e+"&sensor=false",l="<a href='http://maps.google.com/?q="+o.gsearch+"' target='_blank'><img src='"+i+"'></a>";$("#map-canvas-"+s).html(""),$("#map-canvas-"+s).append(l),$("#map-canvas-"+s).on("click",function(a){a.stopPropagation()})}})})},$(document).on("ready",cardSetup),$(document).on("page:load",cardSetup);